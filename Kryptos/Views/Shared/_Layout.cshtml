@using Kryptos.Models
@using Kryptos.Controllers
@using System.Configuration
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8" />
    <title>Welcome to KryptosText Admin</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <link href="http://fonts.googleapis.com/css?family=Open+Sans" rel='stylesheet' type='text/css'>
    <link href="~/styles/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="~/styles/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/styles/css/layout.min.css" rel="stylesheet" type="text/css" />
    <link href="~/styles/css/default.min.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="~/styles/css/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/styles/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/styles/css/dataTables.jqueryui.min.css" rel="stylesheet" />
    <link href="~/styles/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/styles/css/bootstrap-multiselect.css" rel="stylesheet" type="text/css" />
    <link href="~/styles/css/jquery.lwMultiSelect.css" rel="stylesheet" type="text/css" />
    <link href="~/styles/css/bootstrap-treeview.min.css" rel="stylesheet" type="text/css" />
    <link href="~/styles/css/loading.min.css" rel="stylesheet" type="text/css" />
    <link href="~/styles/css/jquery.simplefileinput.min.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="~/styles/imgs/favicon.ico" />
    <link href="~/styles/css/notify-flat.css" rel="stylesheet" type="text/css" />
    <link href="~/styles/css/jquery.treegrid.css" rel="stylesheet" type="text/css" />
    @*<link href="~/styles/css/notify-dark.css" rel="stylesheet" type="text/css" />*@
    <link href="~/styles/css/ui.jqgrid.css" rel="stylesheet" />
    <style>
        .checkbox label:after,
        .radio label:after {
            content: '';
            display: table;
            clear: both;
        }

        .checkbox .cr,
        .radio .cr {
            position: relative;
            display: inline-block;
            border: 1px solid #a9a9a9;
            border-radius: .25em;
            width: 1.3em;
            height: 1.3em;
            float: left;
            margin-right: .5em;
        }

        .radio .cr {
            border-radius: 50%;
        }

            .checkbox .cr .cr-icon,
            .radio .cr .cr-icon {
                position: absolute;
                font-size: .8em;
                line-height: 0;
                top: 50%;
                left: 20%;
            }

            .radio .cr .cr-icon {
                margin-left: 0.04em;
            }

        .checkbox label input[type="checkbox"],
        .radio label input[type="radio"] {
            display: none;
        }

            .checkbox label input[type="checkbox"] + .cr > .cr-icon,
            .radio label input[type="radio"] + .cr > .cr-icon {
                transform: scale(3) rotateZ(-20deg);
                opacity: 0;
                transition: all .3s ease-in;
            }

            .checkbox label input[type="checkbox"]:checked + .cr > .cr-icon,
            .radio label input[type="radio"]:checked + .cr > .cr-icon {
                transform: scale(1) rotateZ(0deg);
                opacity: 1;
            }

            .checkbox label input[type="checkbox"]:disabled + .cr,
            .radio label input[type="radio"]:disabled + .cr {
                opacity: .5;
            }

        .error {
            color: red;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 12px;
        }

        .multiselectListError {
            color: red;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 12px;
            border: 2px solid red;
        }

        .datatable-headerrow {
            text-align: center !important;
        }

        .datatable-cellvalign {
            vertical-align: middle !important;
        }

        .bold {
            font-size: 50px;
        }
       
         .vcenter {
            display: flex;
            align-items: center;
        }

        .padding-10 {
            padding: 10px;
        }

        /* over rides to nullify the dual images for sorting in datatables */
        /* STARTS HERE */
        table.dataTable thead .sorting:after {
            content: "";
        }

        table.dataTable thead .sorting_asc:after {
            content: "";
        }

        table.dataTable thead .sorting_desc:after {
            content: "";
        }
        /* ENDS HERE */

        .extra-margin {
            margin-right: 15px !important;
            color: #20b2aa;
        }

        .extra-margin-unchecked {
            margin-right: 15px !important;
            color: #a52a2a;
        }

        .padding-15 {
            padding-left: 15px;
            padding-right: 15px;
        }

        .image-center {
            padding-right: 10px;
            position: relative;
            bottom: 2px;
        }
       
        .error {
            color: red;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 12px;
        }

        /* Icon when the collapsible content is shown */
        .btn-profile:after {
            font-family: "Glyphicons Halflings";
            content: "\e114";
            float: right;
            margin-left: 15px;
        }
        /* Icon when the collapsible content is hidden */
        .btn-profile.collapsed:after {
            content: "\e080";
        }

        ui-widget-overlay ui-front {
            opacity: 0.85 !important;
        }
        .emailcss{
          width:20% !important;
      }

        .ruleclass {
            margin-left: 5em;
            margin-right: 5em;
          
        }

        hr {
            height: 0px;
            background: #505050;
            margin-top: 20px;
            margin-bottom: 20px;
            margin-left: -68px;
            margin-right: -70px;
        }


        a.delete {
            outline: none !important;
        }
      
      
    </style>
  
</head>


<body class="page-container-bg-solid" onload="OnLoad(Org_Hidden.value);">

    @{
        string current = ViewData["current view"] as string;
        var manageuser = "";
        var managegroup = "";
        var manageorg = "";
        var managefacilty = "";
        var dashboard = "";
        if (current == "User Import" || current == "Users List")
        {
            manageuser = "active";
        }
        else if (current == "Group List")
        {
            managegroup = "active";
        }
        else if (current == "Organization List")
        {
            manageorg = "active";
        }
        else if (current == "Facility List")
        {
            managefacilty = "active";
        }
        else if (current == "---")
        {
            dashboard = "active";
        }
    }
   @{
       var Check = "";
               var userList = (UserLoginInformation)ViewData["CURRENTUSER"];
              if(userList.IsOrganisationAdmin&&userList.IsSuperAdmin==false)
              {
                  Check = "Organization";
              }
              else if(userList.IsFacilityAdmin&&userList.IsSuperAdmin==false)
              {
                  Check = "Facility";
              }
}
    <input id="Org_Hidden" type="hidden" value="@Check" />
    <div class="page-header">
        <div class="page-header-top">
            <div class="container-fluid">
                <div class="page-logo">
                    <a href="#"> <img src="~/styles/imgs/whitelogo.png" title="KRYPTOSTEXT" class="pull-left logo-default"> </a>

                </div>
                <a href="javascript:;" class="menu-toggler"></a>



                <div class="page-header-menu pull-left">
                    <div class="container-fluid">
                        <div class="hor-menu">
                            <ul class="nav navbar-nav">
                                <li class="menu-dropdown classic-menu-dropdown @dashboard" id="dashboard"><a href="javascript:;" class="cmn-t-underline">Dashboard</a></li>
                                <li class="menu-dropdown classic-menu-dropdown @manageuser">
                                    <a href="javascript:;" class="cmn-t-underline">Manage User &nbsp;<span class="caret"></span></a>
                                    <ul class="dropdown-menu pull-left">
                                        <li><a href='@Url.Action("List","UserDatatables")' class="nav-link cmn-t-underline">Users List</a></li>
                                        <li><a href='@Url.Action("Index","UserImport")' class="nav-link cmn-t-underline">Import Users</a></li>
                                        <li><a href='@Url.Action("List","UsersExport")' class="nav-link cmn-t-underline">Export Users</a></li>


                                    </ul>
                                </li>

                                <li class="menu-dropdown classic-menu-dropdown @managegroup">
                                    <a href="javascript:;" class="cmn-t-underline">Manage Group &nbsp;<span class="caret"></span></a>
                                    <ul class="dropdown-menu pull-left">
                                        <li><a href='@Url.Action("List","Chatgroup")' class="nav-link cmn-t-underline">Group List</a></li>
                                        <li><a href='@Url.Action("GroupExportList","ChatGroup")' class="nav-link cmn-t-underline">Group Export</a></li>


                                    </ul>
                                </li>
                               
                                <li class="menu-dropdown classic-menu-dropdown @manageorg" id="OrgList">
                                    <a href="javascript:;" class="cmn-t-underline">Manage Organization &nbsp;<span class="caret"></span></a>

                                    <ul class="dropdown-menu pull-left">
                                        <li><a href='@Url.Action("List","Organisation")' class="nav-link cmn-t-underline">Organization List</a></li>
                                        <li><a href='@Url.Action("OrganizationExportList", "Organisation")' class="nav-link cmn-t-underline">Organization Export</a></li>

                                    </ul>
                                </li>

                                <li class="menu-dropdown classic-menu-dropdown @managefacilty" id="FacilityList">
                                    <a href="javascript:;" class="cmn-t-underline">Manage Facility &nbsp;<span class="caret"></span></a>

                                    <ul class="dropdown-menu pull-left">
                                        <li><a href='@Url.Action("List","Facility")' class="nav-link cmn-t-underline">Facility List</a></li>
                                        <li><a href='@Url.Action("FacilityExportList","Facility")' class="nav-link cmn-t-underline">Facility Export</a></li>

                                    </ul>
                                </li>



                            </ul>
                        </div>
                    </div>
                </div>

                <ul class="nav navbar-nav navbar-right mobile-user-profile">
                    <li class="dropdown" data-toggle="collapse" data-target="#demo">
                        <a href="#" class="dropdown-toggle">
                            @{
                                string UploadDirectory = ConfigurationManager.AppSettings["Image"];
                                var user = (UserLoginInformation)ViewData["CURRENTUSER"];
                                var fstname = user.FirstName;
                                var profilepic = @user.ProfileURL;
                                var img = "Default.png";
                                if (profilepic == null || profilepic.Length == 0) profilepic = @UploadDirectory + "/" + @img;
                            }

                            @{
                                string loginrole = "";
                                if (user.IsSuperAdmin)
                                {
                                    loginrole = "Super Admin";
                                }
                                else if (user.IsOrganisationAdmin)
                                {
                                    loginrole = "Organization Admin";
                                }
                                else if (user.IsFacilityAdmin)
                                {
                                    loginrole = "Facility Admin";
                                }
                                else
                                {
                                    loginrole = "Normal User";
                                }
                            }


                            Welcome <strong> @fstname (@loginrole) &nbsp;<span class="caret"></span></strong>

                        </a>


                        <div id=" demo" style="padding:10px;">
                            <ul class="dropdown-menu col-lg-12" id="menu1">

                                <li>
                                    <div style="padding:10px;">
                                        <strong>Organization Name:</strong> @user.Facility.OOrganisation.Name <br />
                                        @{
                                            if (@Session["OrgAdmin"] != null)
                                            {
                                                <strong>Other Organizations:</strong>
                                                int i = 0;
                                                foreach (var Orgs in (List<string>)Session["OrgAdmin"])
                                                {
                                                    string comma = ",";
                                                    if (i > 0)
                                                    {@comma;
                                                    }
                                                    @Orgs.ToString();
                                                                    i++;
                                                }
                                                <br />
                                            }
                                        }
                                        <strong>Primary Facility:</strong>@user.Facility.FacilityMasterName<br />
                                        @{
                                            if (@Session["FacAdmin"] != null)
                                            {
                                                <strong>Other Facilites:</strong>
                                                int j = 0;
                                                foreach (var Fac in (List<string>)Session["FacAdmin"])
                                                {
                                                    string comma = ",";
                                                    if (j > 0)
                                                    {
                                                        @comma;
                                                    }
                                                    @Fac.ToString();
                                                                   j++;
                                                }
                                                <br />
                                            }
                                        }
                                        <strong>Created Date:</strong>@user.CreatedDate.Value.ToString("dd/MM/yyyy HH:mm:ss")<br />
                                        <strong>Contact No:</strong>@user.ContactNumber<br />
                                        <strong>Email Id:</strong>@user.EmailId

                                    </div>
                                </li>
                                <li class="divider navbar-login-session-bg"></li>
                                <li><a href="#" id="changePassword">Change Password</a></li>
                                <li class="divider"></li>
                                <li><a href='@Url.Action("Logout","Login")'>Logout </a></li>
                            </ul>


                        </div>
                    </li>

                </ul>

            </div>
            <!-- END HEADER TOP -->
            <!-- BEGIN HEADER MENU -->


        </div>
        <!-- END HEADER -->
        <!-- BEGIN CONTAINER -->
        
            @RenderBody()
      
        <!-- END CONTAINER -->
        <div class="page-footer">
            <div class="container-fluid">&copy; 2017 KRYPTOSTEXT | All rights reserved</div>
        </div>
        <div class="scroll-to-top"> <i class="icon-arrow-up"></i> </div>
    </div>


    <div class="row">
        <div id="notes"></div>
    </div>

    <div class="row" id="ChangePwdDiv" style="display: none; padding-left: 30px; padding-right: 30px;">
        <form class="login-form" id="ResetPasswordForm" method="post">
            <div class="form-group">
                <label class="control-label visible-ie8 visible-ie9" id="lblFirstName">Old Password </label>

                <div class="input-icon">
                    <input class="form-control placeholder-no-fix" type="password" placeholder="" id="txtOldPassword" name="OldPassword">
                </div>
                <label id="lblOldPassword"></label>
            </div>
            <div class="form-group">
                <label class="control-label visible-ie8 visible-ie9" id="lblFirstName">New Password </label>
                <div class="input-icon">
                    <input class="form-control placeholder-no-fix" type="password" placeholder="" id="txtNewPassword" name="NewPassword">
                </div>
                <label id="lblNewPassword"></label>
            </div>
            <div class="form-group">
                <label class="control-label visible-ie8 visible-ie9" id="lblFirstName">Confirm Password </label>
                <div class="input-icon">
                    <input class="form-control placeholder-no-fix" type="password" placeholder="" id="txtConfirmPassword" name="ConfirmPassword">
                </div>
                <label id="lblConfirmPassword"></label>
            </div>


            <button type="button" id="btnResetPassword" class="btn btn-primary" style="margin-left: 190px; margin-bottom: 17px; ">Reset Password</button>
        </form>
    </div>

    <!--[if lt IE 9]>
        <script src="styles/global/plugins/respond.min.js"></script>
        <script src="styles/global/plugins/excanvas.min.js"></script>
        <![endif]-->

    <script src="~/styles/js/jquery.min.js" type="text/javascript"></script>
    <script src="~/styles/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="~/styles/js/app.min.js" type="text/javascript"></script>
    <script src="~/styles/js/layout.min.js" type="text/javascript"></script>
    <script src="~/styles/js/jquery-ui.min.js" type="text/javascript"></script>
    <script src="~/styles/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="~/styles/js/dataTables.jqueryui.min.js" type="text/javascript"></script>
    <script src="~/styles/js/dataTables.bootstrap.min.js" type="text/javascript"></script>
    <script src="~/styles/js/uploadify/jquery.uploadify.min.js"></script>
    <script src="~/styles/js/bootstrap-multiselect.js" type="text/javascript"></script>
    <script src="~/styles/js/jquery.lwMultiSelect.min.js" type="text/javascript"></script>
    <script src="~/styles/js/FormValidation.min.js" type="text/javascript"></script>
    <script src="~/styles/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="~/styles/js/additional-methods.min.js" type="text/javascript"></script>
    <script src="~/styles/js/bootstrap-treeview.min.js" type="text/javascript"></script>
    <script src="~/styles/js/jquery.loading.min.js" type="text/javascript"></script>
    <script src="~/styles/js/jquery.simplefileinput.min.js" type="text/javascript"></script>
    <script src="~/styles/js/notify.min.js" type="text/javascript"></script>
    <script src="~/styles/js/treegrid/jquery.treegrid.min.js" type="text/javascript"></script>
    <script src="~/styles/js/treegrid/jquery.treegrid.bootstrap3.js" type="text/javascript"></script>
    @*<script src="~/styles/js/jquery-1.9.1.min.js"></script>
        <script src="~/styles/js/jquery-ui-1.10.4.min.js"></script>
        <script src="~/Scripts/i18n/grid.locale-en.js"></script>*@
    <script src="~/styles/js/jquery.jqGrid.min.js"></script>
    <script src="~/styles/js/jquery.jqGrid.js"></script>


    <script type="text/javascript">
        jQuery.extend(jQuery.validator.messages, {
            required: "This field is required.",
            remote: "This is already taken.",
            email: "Please enter a valid email address.",
            url: "Please enter a valid URL.",
            date: "Please enter a valid date.",
            dateISO: "Please enter a valid date (ISO).",
            number: "Please enter a valid number.",
            digits: "Please enter only digits.",
            creditcard: "Please enter a valid credit card number.",
            equalTo: "Please Enter the Confirm Password Same as New Password.",
            accept: "Please enter a value with a valid extension.",
            maxlength: jQuery.validator.format("Please enter no more than {0} characters."),
            minlength: jQuery.validator.format("Please enter at least {0} characters."),
            rangelength: jQuery.validator.format("Please enter a value between {0} and {1} characters long."),
            range: jQuery.validator.format("Please enter a value between {0} and {1}."),
            max: jQuery.validator.format("Please enter a value less than or equal to {0}."),
            min: jQuery.validator.format("Please enter a value greater than or equal to {0}.")
        });

        $.validator.addMethod("zipcode",
        function (value, element, regexp) {
        var re = new RegExp(/^[0-9]{5}$/);
        return !this.optional(element) || re.test(value);
    },
    "Not a valid zipcode");

        $.validator.addMethod("mypassword",
        function (value, element, regexp) {
            var re = new RegExp(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@@#\$%\^&\*\[\]"\';:_\-<>\., =\+\/\\]).{8,10}$/);
          //  var re = new RegExp(/(?=^.{8,15}$)(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@@#$%^&amp;*()_+}{&quot;:;'?/&gt;.&lt;,])(?!.*\s).*$/);
            return re.test(value);
        },
"Atleast 1 small-case letter, 1 Capital letter, 1 digit, 1 special character and the length should be between 8-10 characters. The sequence of the characters is not important");

        //jQuery.validator.addMethod("zipcode", function (a, b, c) {
        //    return !!this.optional(b) || c.test("/^[0-9]{5}$/");
        //}, "Not a valid zipcode");



        var notes;

        function callnotify(message, type) {
            var msgtype = "success";
            switch (type) {
                case 1:
                    msgtype = "success";
                    break;
                case 2:
                    msgtype = "info";
                    break;
                case 3:
                    msgtype = "warning";
                    break;
                case 4:
                    msgtype = "danger";
                    break;
                default:
                    msgtype = "success";
                    break;
            }

            notes.show(message, {
                // 'success', 'info', 'warning', 'danger'
                type: '' + msgtype + ''
            });
        }
       
        function OnLoad(Checking)
        {
            if (Checking == "Organization")
                $('#OrgList').hide();
            else if (Checking == "Facility")
            {
                $('#OrgList').hide();
                $('#FacilityList').hide();
            }           
        }     

        $(document).on('click', '.dropdown-menu', function (e) {
           
            e.stopPropagation();
        });

        $(".dropdown-toggle").on("click", function () {
            $("#menu1").toggle();
           
        });

        $(document).on("click", function (event) {
            var $trigger = $(".dropdown");
            if ($trigger !== event.target && !$trigger.has(event.target).length) {
                $("#menu1").hide();
            }
        });

        var form;
        $(document).ready(function () {
            $("#dashboard").hide();
            notes = $('#notes').notify({
                type: 'notes',
                sticky: true,
                delay: 1000,
                removeIcon: '<i class="fa fa-remove"></i>'
            });

        });
        $("#changePassword").click(function () {
           
             $('#menu1').hide();
                $("#ResetPasswordForm")[0].reset();
                $("#ResetPasswordForm").validate().resetForm();
                $("#ChangePwdDiv").dialog({
                    title: "Reset Password",
                    width: 600,
                    Height: 400,
                    modal: true
                
                });        
        });
      

        $("#btnResetPassword").click(function () {


            if ($("#ResetPasswordForm").valid()) {

                var oldpwd = $("#txtOldPassword").val();
                var newpwd = $("#txtNewPassword").val();
                var confirmpwd = $("#txtConfirmPassword").val();

                $.ajax({
                    url: '@Url.Action("SetResetPassword", "Login")',
                    type: "Get",
                    data: { oldPassword: "" + oldpwd + "", userid: "" + @user.USERID + "", newpassword: "" + newpwd + "" },
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    cache: false,
                    success: function (res) {

                        if (res == 2) {
                            $("#lblOldPassword").html("Your Old Password Was Wrong").addClass("error");
                        }
                        else {

                            callnotify("Your Password has been Updated Successfully.", 2);
                            $("#ChangePwdDiv").dialog('close');

                        }

                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(xhr.responseText);
                    }
                });

            }
        });

        var recordid =@user.USERID
    form = $("#ResetPasswordForm").validate({
        debug: true,
        rules: {
            OldPassword: {
                required: true,
            },
            NewPassword: {
                required: true,
                mypassword: true
            },
            ConfirmPassword: {
                required: true,
                equalTo: '[name="NewPassword"]'
            },
            messages: {
                OldPassword: {
                    required: "Old Password Is Required!",
                },
                NewPassword: {
                    required: "New Password Is Required!",
                },
                ConfirmPassword: {
                    required: "Confirm Password Is Required!",
                    equalTo: "confirm password must match with New Password"
                }
            }

        }
    });

        function UpdateRecordStatusJs(rec_status) {
            $.ajax({
                url: '@Url.Action("UpdateRecordState", "Login")',
                type: "Get",
                async: false,
                cache: false,
                contentType: "application/json; charset=utf-8",
                data: { state: '' + rec_status + '' },
                datatype: "json",
                success: function (RecordStatus) {

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    debugger;
                }
            });
        }

        function GetRecordStateJs() {
            var state = false;
            $.ajax({
                url: '@Url.Action("GetRecordState", "Login")',
                type: "Get",
                async: false,
                cache: false,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (RecordStatus) {
                    state = RecordStatus;
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    state = false;
                    debugger;
                }
            });
            return state;
        }

        $(document).ready(function () {
            UpdateRecordStatusJs(false);
        });

    </script>
    @RenderSection("Bottom", false)
</body>
</html>